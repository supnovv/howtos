
# C API

**lua_load** [-0, +1, –]

int **lua_load**(lua_State* L, lua_Reader reader, void* data, const char* chunkname, const char* mode);

Loads a Lua chunk without running it. 
If there are no errors, `lua_load` pushes the compiled chunk as a Lua function on top of the stack. 
Otherwise, it pushes an error message.

The return values of `lua_load` are:
- LUA_OK: no errors;
- LUA_ERRSYNTAX: syntax error during precompilation;
- LUA_ERRMEM: memory allocation error;
- LUA_ERRGCMM: error while running a `__gc` metamethod. 
  (This error has no relation with the chunk being loaded. It is generated by the garbage collector.)

The `lua_load` function uses a user-supplied reader function to read the chunk (see `lua_Reader`). 
The `data` argument is an opaque value passed to the reader function.

The chunkname argument gives a name to the chunk, 
which is used for error messages and in debug information (see §4.9).

`lua_load` automatically detects whether the chunk is text or binary 
and loads it accordingly (see program `luac`). 
The string mode works as in function `load`, 
with the addition that a `NULL` value is equivalent to the string "bt".

`lua_load` uses the stack internally, 
so the reader function must always leave the stack unmodified when returning.

If the resulting function has upvalues, its first upvalue is set to the value of the global environment 
stored at index `LUA_RIDX_GLOBALS` in the registry (see §4.5). 
When loading main chunks, this upvalue will be the `_ENV` variable (see §2.2). 
Other upvalues are initialized with `nil`.

typedef const char* (* **lua_Reader**) (lua_State *L, void *data, size_t *size);

The reader function used by `lua_load`. 
Every time it needs another piece of the chunk, `lua_load` calls the reader, passing along its `data` parameter.
The reader must return a pointer to a block of memory with a new piece of the chunk 
and set size to the block size.
The block must exist until the reader function is called again. 
To signal the end of the chunk, the reader must return NULL or set size to zero. 
The reader function may return pieces of any size greater than zero.

**luaL_loadbuffer** [-0, +1, –]

int **luaL_loadbuffer**(lua_State *L, const char *buff, size_t sz, const char *name);
                     
Equivalent to `luaL_loadbufferx` with `mode` equal to NULL.

**luaL_loadbufferx** [-0, +1, –]

int **luaL_loadbufferx**(lua_State *L, const char *buff, size_t sz, const char *name, const char *mode);

Loads a buffer as a Lua chunk. 
This function uses `lua_load` to load the chunk in the buffer pointed to by `buff` with size `sz`.

This function returns the same results as `lua_load`. 
`name` is the chunk name, used for debug information and error messages. 
The string mode works as in function `lua_load`.

**luaL_loadfile** [-0, +1, e]

int luaL_loadfile (lua_State *L, const char *filename);
Equivalent to luaL_loadfilex with mode equal to NULL.

**luaL_loadfilex** [-0, +1, e]

int luaL_loadfilex (lua_State *L, const char *filename,
                                            const char *mode);
Loads a file as a Lua chunk. This function uses lua_load to load the chunk in the file named filename. If filename is NULL, then it loads from the standard input. The first line in the file is ignored if it starts with a #.

The string mode works as in function lua_load.

This function returns the same results as lua_load, but it has an extra error code LUA_ERRFILE if it cannot open/read the file or the file has a wrong mode.

As lua_load, this function only loads the chunk; it does not run it.

**luaL_loadstring** [-0, +1, –]

int luaL_loadstring (lua_State *L, const char *s)

Loads a string as a Lua chunk. This function uses lua_load to load the chunk in the zero-terminated string s.

This function returns the same results as lua_load.

Also as lua_load, this function only loads the chunk; it does not run it.


# Lua Stdlib

**load (chunk [, chunkname [, mode [, env]]])**

Loads a chunk. If chunk is a string, the `chunk` is this string. 
If `chunk` is a function, `load` calls it repeatedly to get the chunk pieces. 
Each call to chunk must return a string that concatenates with previous results. 
A return of an empty string, `nil`, or no value signals the end of the chunk.

If there are no syntactic errors, returns the compiled chunk as a function; 
otherwise, returns `nil` plus the error message.

If the resulting function has upvalues, the first upvalue is set to the value of `env`, 
if that parameter is given, or to the value of the global environment. 
Other upvalues are initialized with `nil`. 
(When you load a main chunk, the resulting function will always have exactly one upvalue, 
the `_ENV` variable (see §2.2).
However, when you load a binary chunk created from a function (see `string.dump`), 
the resulting function can have an arbitrary number of upvalues.) 
All upvalues are fresh, that is, they are not shared with any other function.

`chunkname` is used as the name of the chunk for error messages and debug information (see §4.9). 
When absent, it defaults to chunk if chunk is a string, or to `"=(load)"` otherwise.

The string `mode` controls whether the chunk can be text or binary (that is, a precompiled chunk). 
It may be the string `"b"` (only binary chunks), `"t"` (only text chunks), or `"bt"` (both binary and text). 
The default is `"bt"`.

Lua does not check the consistency of binary chunks. 
Maliciously crafted binary chunks can crash the interpreter.

**loadfile ([filename [, mode [, env]]])**

Similar to `load`, but gets the chunk from file filename or from the standard input, if no file name is given.

